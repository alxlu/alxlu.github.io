Detector.webgl||Detector.addGetWebGLMessage();var container,stats,camera,scene,renderer,objects,composer,particleLight,pointLight,dae,skin,mouseX=0,mouseY=0,beat=!0,loader=new THREE.ColladaLoader;loader.options.convertUpAxis=!0;loader.load("heartanim03.dae",function(a){dae=a.scene;skin=a.skins[0];dae.scale.x=dae.scale.y=dae.scale.z=0.2;dae.position.y-=2;dae.updateMatrix();init();animate()});
function init(){container=document.createElement("div");document.body.appendChild(container);camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2E3);camera.position.set(2,2,3);scene=new THREE.Scene;scene.fog=new THREE.Fog(0,1,1E3);scene.add(dae);particleLight=new THREE.Mesh(new THREE.SphereGeometry(4,8,8),new THREE.MeshBasicMaterial({color:6710886}));scene.add(particleLight);scene.add(new THREE.AmbientLight(13421772));var a=new THREE.DirectionalLight(6710886);a.position.x=
Math.random()-0.5;a.position.y=Math.random()-0.5;a.position.z=Math.random()-0.5;a.position.normalize();scene.add(a);pointLight=new THREE.PointLight(6710886,4);pointLight.position=particleLight.position;scene.add(pointLight);renderer=new THREE.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight);renderer.setClearColor(2105376,1);composer=new THREE.EffectComposer(renderer);composer.addPass(new THREE.RenderPass(scene,camera));a=new THREE.FilmPass(0.35,0.5,2048,!1);composer.addPass(a);
a=new THREE.ShaderPass(THREE.RGBShiftShader);a.uniforms.amount.value=0.001;a.renderToScreen=!0;composer.addPass(a);container.appendChild(renderer.domElement);stats=new Stats;stats.domElement.style.position="absolute";stats.domElement.style.top="0px";container.appendChild(stats.domElement);window.addEventListener("mousemove",onMouseMove,!1);window.addEventListener("resize",onWindowResize,!1);window.addEventListener("click",onClick,!1)}
function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}var t=0,clock=new THREE.Clock,theta=0,duration=24*(1E3/15),keyframes=24,interpolation=duration/keyframes,lastKeyframe=0,currentKeyframe=0,curtime=0;
function animate(){requestAnimationFrame(animate);if(beat){var a=(Date.now()-curtime)%duration,b=Math.floor(a/interpolation);b!=currentKeyframe&&(skin.morphTargetInfluences[lastKeyframe]=0,skin.morphTargetInfluences[currentKeyframe]=1,skin.morphTargetInfluences[b]=0,lastKeyframe=currentKeyframe,currentKeyframe=b);skin.morphTargetInfluences[b]=a%interpolation/interpolation;skin.morphTargetInfluences[lastKeyframe]=1-skin.morphTargetInfluences[b];23===b&&(beat=!1)}render();stats.update()}
function render(){var a=5E-4*Date.now();dae.rotation.y=0.005*mouseX;camera.position.x=10;camera.position.y=0.01*(mouseY-window.innerHeight/2);camera.position.z=5;camera.lookAt(scene.position);particleLight.position.x=3009*Math.sin(a);particleLight.position.y=4E3*Math.cos(a/1.5);particleLight.position.z=3009*Math.cos(a/2);composer.render(scene,camera)}function onMouseMove(a){mouseX=a.clientX;mouseY=a.clientY}function onClick(a){beat||(beat=!0,curtime=Date.now())};
